<!-- index.html -->
<!DOCTYPE html>
<html>
<head>
  <title>留言板</title>
  <style>
    .message { margin: 10px 0; padding: 10px; border: 1px solid #ddd; }
    #messageForm { margin: 20px 0; }
  </style>
</head>
<body>
  <h1>留言板</h1>
  <form id="messageForm">
    <input type="text" id="name" placeholder="你的名字" required>
    <textarea id="content" placeholder="留言内容" required></textarea>
    <button type="submit">提交</button>
  </form>
  <div id="messages"></div>

  // 引入 LeanCloud SDK
<script src="https://cdn.jsdelivr.net/npm/leancloud-storage@4.13.0/dist/av-min.js"></script>

<script>
  // 初始化 LeanCloud
  const appId = "mv0CXsSCpCxNXCIL4q9cHxak-gzGzoHsz";
  const appKey = "qxwAnFR6JrdscOAz376bZJ6P"; // 注意：这里用「应用 Keys」中的 App Key（不是 Master Key）
  serverURL: "https://mv0cxssc.lc-cn-n1-shared.com"
  AV.init({ appId, appKey });

  // 加载已有留言
  function loadMessages() {
    const Message = AV.Object.extend('Message');
    const query = new AV.Query(Message);
    query.descending('createdAt'); // 按时间倒序
    query.find().then(messages => {
      const container = document.getElementById('messages');
      container.innerHTML = messages.map(msg => `
        <div class="message">
          <strong>${msg.get('name')}</strong>
          <p>${msg.get('content')}</p>
          <small>${new Date(msg.createdAt).toLocaleString()}</small>
        </div>
      `).join('');
    });
  }

  // 提交新留言
  document.getElementById('messageForm').addEventListener('submit', (e) => {
    e.preventDefault();
    const name = document.getElementById('name').value;
    const content = document.getElementById('content').value;

    const Message = AV.Object.extend('Message');
    const message = new Message();
    message.save({ name, content }).then(() => {
      alert('留言成功！');
      document.getElementById('messageForm').reset();
      loadMessages(); // 重新加载留言列表
    }).catch(err => alert('提交失败：' + err.message));
  });

  // 页面加载时获取留言
  loadMessages();
</script>
</body>
</html>
